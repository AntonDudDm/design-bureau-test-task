# Моделирование отделения космического аппарата от ступени РН

Данный проект реализует численное моделирование процесса отделения космического аппарата (КА) от ступени ракеты-носителя (РН) с использованием толкателя (пружины) в центральном гравитационном поле Земли.

Решение выполнено в среде **GNU Octave**.

---

## 1. Требования

- GNU Octave (рекомендуемая версия: 7.x или новее)
- Дополнительные пакеты не требуются

---

## 2. Быстрый запуск

В корневой директории проекта выполните:

```octave
run
```

Альтернативно можно воспользоваться GUI, выполнив в корневой директории проекта:

```octave
gui_app
```

Скрипт:

* выполняет численное интегрирование уравнений движения на интервале 0–5 с;
* сохраняет результаты в CSV-файл с шагом по времени 0.01 с;
* строит графики и сохраняет их в папку `output/`.

---

## 3. Исходные данные задачи

### Орбита (инерциальная СК ECI, J2000)

* Большая полуось: `a = 6700 км`
* Эксцентриситет: `e = 0.003`
* Наклонение: `i = 80°`
* Долгота восходящего узла: `Ω = −15°`
* Аргумент перицентра: `ω = 30°`
* Средняя аномалия в момент отделения: `M0 = 0°`

### Массы

* Масса ступени РН: `m_lv = 3500 кг`
* Масса КА: `m_sc = 3100 кг`

### Толкатель

* Жёсткость: `k = 30000 Н/м`
* Свободная длина: `L_free = 0.220 м`
* Начальная длина: `L0 = 0.110 м`
* Длина отключения: `L_end = 0.195 м`

### Направление отделения

Ось отделения совпадает с направлением начальной орбитальной скорости:

$$\mathbf{u} = \frac{\mathbf{v}_0}{|\mathbf{v}_0|}$$


---

## 4. Математическая модель

КА и ступень РН моделируются как материальные точки, движущиеся в центральном гравитационном поле Земли.

### Гравитационное ускорение


$$\mathbf{a}_g(\mathbf{r}) = -\mu \frac{\mathbf{r}}{|\mathbf{r}|^3}
$$

### Сила толкателя

Текущая длина толкателя:

$$L = (\mathbf{r}_{SC} - \mathbf{r}_{LV}) \cdot \mathbf{u}$$

Закон силы:

$$F =
\begin{cases}
k (L_{free} - L), & L < L_{free} \ \text{и} \ L < L_{end}, \
0, & \text{иначе}.
\end{cases}$$


Сила прикладывается вдоль оси `u`:

* к КА: `+F u`,
* к РН: `−F u`.

Полный вектор состояния:

$$x = [\mathbf{r}*{LV}, \mathbf{v}*{LV}, \mathbf{r}*{SC}, \mathbf{v}*{SC}] \in \mathbb{R}^{12}$$


Система интегрируется численно с помощью `ode45`.

---

## 5. Формат выходного CSV-файла

Файл: `output/results.csv`
Шаг по времени: `Δt = 0.01 с`

Порядок столбцов:

1. `t` — время, с
2. `r_lv_x`, `r_lv_y`, `r_lv_z` — положение РН, м
3. `v_lv_x`, `v_lv_y`, `v_lv_z` — скорость РН, м/с
4. `r_sc_x`, `r_sc_y`, `r_sc_z` — положение КА, м
5. `v_sc_x`, `v_sc_y`, `v_sc_z` — скорость КА, м/с
6. `d` — относительное расстояние, м
7. `v_rel` — относительная скорость, м/с
8. `F` — сила толкателя, Н

---

## 6. Графики

В папку `output/` сохраняются следующие изображения:

* `traj3d.png` — 3D-траектории КА и РН в ECI
* `distance.png` — относительное расстояние
* `vrel.png` — относительная скорость
* `force.png` — сила толкателя

Компоненты векторов (ECI):

* `sc_position_xyz.png` — координаты КА
* `sc_velocity_xyz.png` — скорости КА
* `lv_position_xyz.png` — координаты РН
* `lv_velocity_xyz.png` — скорости РН

Дополнительно:

* `relative_traj_sc_wrt_lv.png` — относительная траектория КА относительно РН
* `traj_center_of_mass_frame.png` — движение в системе центра масс

---

## 7. Тесты и проверка корректности

В папке `tests/` реализованы автоматические проверки:

* проверка точности решения уравнения Кеплера;
* сохранение энергии и момента импульса в двухтельной задаче (при отключённом толкателе);
* сохранение полного импульса системы при отсутствии гравитации.

Запуск тестов:

```octave
cd tests
run_tests
```

---

## 8. Структура проекта

* `run.m` — основной сценарий запуска
* `gui_app.m` - графическая оболочка (альтернарнативный способ запуска) 
* `src/` — исходный код
  * `kepler_E.m` — решение уравнения Кеплера
  * `kepler2rv.m` — переход от кеплеровых элементов к векторам r, v
  * `rotmat.m` — матрицы вращения
  * `spring_force.m` — модель толкателя
  * `rhs_sep.m` — правая часть уравнений движения
  * `simulate_sep.m` — численное интегрирование
  * `export_csv.m` — экспорт результатов
  * `plot_orbit_eci_from_elements.m` - отрисовка кеплеровской орбиты КА и РН при отсутствии отстыковки по заданным кеплеровским элементам
  * `postprocess.m` — построение графиков
* `tests/` — тесты корректности и верификации
  * `run_tests.m` — единая точка запуска всех тестов
  * `test_kepler_residual.m` — проверка невязки уравнения Кеплера `E - e sin(E) - M ≈ 0`
  * `test_two_body_invariants_no_spring.m` — проверка сохранения интегралов двухтельной задачи при `k = 0`
    (энергия и момент импульса для КА и РН)
  * `test_momentum_conservation_no_gravity.m` — проверка сохранения полного импульса системы при `μ = 0`
    (внутренние силы толкателя не должны менять импульс/скорость ЦМ)
  * `plot_orbit_eci.m` - отрисовка кеплеровской орбиты КА и РН при отсутствии отстыковки
* `docs/` — документация и материалы тестового задания
  * `Description.md` — описание физической модели, численных методов и структуры реализации
  * `Тестовое_задание_...pdf` — исходное ТЗ
* `output/` — выходные файлы (генерируются при запуске)
  * `results.csv` — таблица результатов
  * `*.png` — сохранённые графики

---
